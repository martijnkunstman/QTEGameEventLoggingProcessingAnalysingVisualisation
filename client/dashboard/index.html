<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Whac-A-Mole — Session Visualizer</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <header class="page-header">
    <h1>Whac-A-Mole — Session Visualizer</h1>
    <div class="meta">
      <div><strong>Game ID:</strong> <span id="gameId">—</span></div>
      <div><strong>Duration:</strong> <span id="duration">—</span></div>
      <div><strong>Final Score:</strong> <span id="finalScore">—</span></div>
    </div>
  </header>

  <main class="layout">
    <!-- LEFT: Grid heatmap -->
    <section class="card">
      <h2>Grid Heatmap (4×4)</h2>
      <div id="grid" class="grid"></div>
      <div class="legend">
        <span class="dot hit"></span> Hit &nbsp; <span class="dot miss"></span> Miss &nbsp; <span class="dot show"></span> Appear
      </div>
      <small class="hint">Cell labels are <code>row,col</code>. Tooltip shows shows/hits/misses.</small>
    </section>

    <!-- RIGHT: Score over time -->
    <section class="card">
      <h2>Score over Time</h2>
      <svg id="scoreChart" class="chart" viewBox="0 0 800 300" preserveAspectRatio="none" aria-label="Score over time"></svg>
      <div class="scrub">
        <label for="scrubber">Scrub time</label>
        <input id="scrubber" type="range" min="0" max="10" step="0.001" value="0" />
        <span id="tNow">0.000s</span>
      </div>
    </section>

    <!-- Timeline -->
    <section class="card wide">
      <h2>Event Timeline</h2>
      <svg id="timeline" class="timeline" viewBox="0 0 800 120" preserveAspectRatio="none" aria-label="Event timeline"></svg>
      <div class="legend">
        <span class="pill start">GAME_START</span>
        <span class="pill show">SHOW</span>
        <span class="pill hit">HIT</span>
        <span class="pill miss">MISS</span>
        <span class="pill end">GAME_END</span>
      </div>
    </section>

    <!-- Raw events -->
    <section class="card wide">
      <h2>Events</h2>
      <div id="eventsList" class="events"></div>
    </section>
  </main>

  <!-- Replace this JSON with any other run to visualize -->
  <script type="application/json" id="data">
{
  "gameId": "20250909-221209-291-92ee",
  "settings": {
    "grid": { "rows": 4, "cols": 4 },
    "duration_ms": 10000,
    "mole_up_ms": { "min": 650, "max": 1200 },
    "idle_gap_ms": { "min": 220, "max": 500 }
  },
  "events": [
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 0, "type": "GAME_START",
      "settings": { "grid": { "rows": 4, "cols": 4 }, "duration_ms": 10000,
      "mole_up_ms": { "min": 650, "max": 1200 }, "idle_gap_ms": { "min": 220, "max": 500 } } },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 0.118, "type": "SHOW", "cell": { "row": 4, "col": 2, "index": 13 } },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 0.857, "type": "HIT", "cell": { "row": 4, "col": 2, "index": 13 }, "pos_rel": { "x": 0.524, "y": 0.5 }, "score": 1 },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 1.502, "type": "SHOW", "cell": { "row": 3, "col": 4, "index": 11 } },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 2.124, "type": "HIT", "cell": { "row": 3, "col": 4, "index": 11 }, "pos_rel": { "x": 0.966, "y": 0.466 }, "score": 2 },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 2.67, "type": "SHOW", "cell": { "row": 1, "col": 3, "index": 2 } },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 2.798, "type": "MISS", "cell": { "row": 3, "col": 3, "index": 10 }, "pos_rel": { "x": 0.362, "y": 0.491 } },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 3.566, "type": "HIT", "cell": { "row": 1, "col": 3, "index": 2 }, "pos_rel": { "x": 0.617, "y": 0.942 }, "score": 3 },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 4.281, "type": "SHOW", "cell": { "row": 3, "col": 3, "index": 10 } },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 5.126, "type": "HIT", "cell": { "row": 3, "col": 3, "index": 10 }, "pos_rel": { "x": 0.711, "y": 0.517 }, "score": 4 },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 5.817, "type": "SHOW", "cell": { "row": 1, "col": 3, "index": 2 } },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 6.452, "type": "HIT", "cell": { "row": 1, "col": 3, "index": 2 }, "pos_rel": { "x": 0.651, "y": 0.636 }, "score": 5 },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 7.054, "type": "SHOW", "cell": { "row": 3, "col": 1, "index": 8 } },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 7.816, "type": "HIT", "cell": { "row": 3, "col": 1, "index": 8 }, "pos_rel": { "x": 0.532, "y": 0.449 }, "score": 6 },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 8.475, "type": "SHOW", "cell": { "row": 4, "col": 3, "index": 14 } },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 8.671, "type": "MISS", "cell": { "row": 3, "col": 2, "index": 9 }, "pos_rel": { "x": 0.515, "y": 0.585 } },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 9.12, "type": "HIT", "cell": { "row": 4, "col": 3, "index": 14 }, "pos_rel": { "x": 0.328, "y": 0.398 }, "score": 7 },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 9.653, "type": "SHOW", "cell": { "row": 4, "col": 2, "index": 13 } },
    { "ts": "2025-09-09T20:12:19.329Z", "t_rel_s": 10.004, "type": "GAME_END", "final_score": 7 }
  ]
}
  </script>

  <script src="./app.js" type="module"></script>
</body>
</html>
